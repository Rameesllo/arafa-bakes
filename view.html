<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Employee Portal</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f0f4f8;
  margin: 0;
  padding: 20px;
}
h1, h2 {
  text-align: center;
  color: #2c3e50;
}
.container {
  max-width: 700px;
  margin: auto;
}
.card {
  background: #fff;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
form label {
  display: block;
  margin-bottom: 10px;
  font-weight: 600;
}
form input {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  margin-bottom: 15px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 14px;
}
form button {
  width: 100%;
  background: #3498db;
  color: #fff;
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
form button:hover {
  background: #2980b9;
}
.employee-details p { margin: 5px 0; }
.attendance-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}
.day-box {
  width: 46px;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 12px;
}
.day {
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  color: #fff;
  transition: 0.3s;
  font-size: 13px;
}
.present { background: #27ae60; }
.half { background: #f39c12; }
.absent { background: #e74c3c; }
.empty { background: #bdc3c7; color: #666; }
.advance-amount {
  font-size: 10px;
  color: #2c3e50;
  margin-top: 2px;
}
.month-section { margin-top: 20px; }
.month-title {
  font-weight: bold;
  margin-bottom: 8px;
  color: #34495e;
}
.salary-info {
  margin-top: 8px;
  font-weight: bold;
  color: #2c3e50;
}
</style>
</head>
<body>
<div class="container">
  <h1>Employee Portal</h1>
  <div class="card">
    <form id="loginForm">
      <label>Email: <input type="email" id="email" required /></label>
      <label>Password: <input type="password" id="password" required /></label>
      <button type="submit">Login</button>
    </form>
  </div>
  <div id="info"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDz-C00gltYO9zkYvcrGnaPVwCHcem-7jY",
  authDomain: "arafa-bakery-33906.firebaseapp.com",
  projectId: "arafa-bakery-33906",
  storageBucket: "arafa-bakery-33906.appspot.com",
  messagingSenderId: "362520951276",
  appId: "1:362520951276:web:ead930237865e9aa69e8c9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const monthNames = [
  "January","February","March","April","May","June","July",
  "August","September","October","November","December"
];

function getDaysInMonth(year, month) {
  return new Date(year, month, 0).getDate();
}

// ðŸ”¹ Login Check
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const snapshot = await getDocs(collection(db, "employees"));
  let found = false;

  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    if (data.email === email && data.password === password) {
      found = true;
      displayEmployee(data);
    }
  });

  if (!found) alert("Invalid email or password!");
});

// ðŸ”¹ Display Employee Info & Attendance
function displayEmployee(data) {
  const container = document.getElementById("info");
  container.innerHTML = `
    <div class="card employee-details">
      <h2>${data.name}</h2>
      <p><b>Position:</b> ${data.position}</p>
      <p><b>Email:</b> ${data.email}</p>
      <p><b>Phone:</b> ${data.phone}</p>
      <p><b>Salary/day:</b> â‚¹${data.salary}</p>
    </div>
  `;

  const attendanceDiv = document.createElement("div");
  attendanceDiv.classList.add("card");

  const attendance = data.attendance || {};
  const advances = data.advances || {};

  const currentDate = new Date();
  const currentMonth = String(currentDate.getMonth() + 1).padStart(2, "0");
  const currentYear = currentDate.getFullYear().toString();
  const currentMonthKey = `${currentYear}-${currentMonth}`;

  // Sort so current month appears first
  const sortedKeys = Object.keys(attendance).sort((a, b) => {
    if (a === currentMonthKey) return -1;
    if (b === currentMonthKey) return 1;
    return a.localeCompare(b);
  });

  let html = "";

  sortedKeys.forEach((monthKey) => {
    const [year, month] = monthKey.split("-");
    const monthIndex = parseInt(month) - 1;
    const daysInMonth = getDaysInMonth(year, month);
    let monthlySalary = 0, totalAdvance = 0;

    html += `<div class="month-section" id="${monthKey}">
      <div class="month-title">${monthNames[monthIndex]} ${year} ${
        monthKey === currentMonthKey ? "(Current Month)" : ""
      }</div>
      <div class="attendance-grid">`;

    for (let d = 1; d <= daysInMonth; d++) {
      const dayStr = d.toString().padStart(2, "0");
      const status = attendance[monthKey]?.[dayStr] || "";
      const advance = advances[monthKey]?.[dayStr] || 0;

      let className =
        status === "P" ? "present" :
        status === "A" ? "absent" :
        status === "H" ? "half" : "empty";

      if (status === "P") monthlySalary += data.salary;
      if (status === "H") monthlySalary += data.salary / 2;
      totalAdvance += advance;

      html += `
        <div class="day-box">
          <div class="day ${className}" title="${status || 'No Data'}">${d}</div>
          ${advance ? `<div class="advance-amount">â‚¹${advance}</div>` : `<div class="advance-amount">&nbsp;</div>`}
        </div>`;
    }

    html += `</div>
      <div class="salary-info">
        Salary: â‚¹${(monthlySalary - totalAdvance).toFixed(2)} (Advance â‚¹${totalAdvance})
      </div>
    </div>`;
  });

  attendanceDiv.innerHTML = html;
  container.appendChild(attendanceDiv);

  // ðŸ”½ Scroll smoothly to current month
  const currentMonthSection = document.getElementById(currentMonthKey);
  if (currentMonthSection) {
    currentMonthSection.scrollIntoView({ behavior: "smooth", block: "start" });
  }
}
</script>
</body>
</html>
