<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Employee Attendance (Mobile Only)</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #f4f8fb;
  margin: 0;
  padding: 10px;
}

h1 {
  text-align: center;
  color: #3498db;
  font-size: 20px;
  margin-bottom: 10px;
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #3498db;
  color: #fff;
  padding: 10px;
  border-radius: 0 0 10px 10px;
}

.navbar button {
  background: #2ce029;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 8px;
  padding: 6px 10px;
}

.container {
  max-width: 500px;
  margin: auto;
}

/* Add Employee Card */
.card {
  background: #fff;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 10px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
}

/* Employee cards */
.employee-card {
  background: #fff;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.employee-card h3 {
  text-align: center;
  color: #3498db;
  margin-bottom: 8px;
}

.employee-card p {
  margin: 6px 0;
  font-size: 14px;
}

.employee-card input, .employee-card select {
  width: 100%;
  padding: 6px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-top: 4px;
}

.attendance-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  justify-content: flex-start;
  margin-top: 10px;
}

.attendance-btn {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  font-weight: bold;
  font-size: 13px;
  color: #fff;
  cursor: pointer;
  border: none;
  transition: 0.2s;
}
.attendance-btn:hover { transform: scale(1.1); }
.present { background: #27ae60; }
.absent { background: #e74c3c; }
.half { background: #f39c12; }
.empty { background: #bdc3c7; color: #666; }

.actions {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}

.btn {
  flex: 1;
  padding: 8px;
  font-weight: bold;
  border: none;
  color: #fff;
  border-radius: 6px;
  margin: 0 3px;
  font-size: 14px;
}
.btn-edit { background: #f1c40f; }
.btn-delete { background: #e74c3c; }
.btn-edit:hover { background: #d4ac0d; }
.btn-delete:hover { background: #c0392b; }

form label {
  font-size: 14px;
  display: block;
  margin-bottom: 8px;
}
form input, form select, form button {
  width: 100%;
  padding: 8px;
  font-size: 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-top: 5px;
  margin-bottom: 10px;
}
form button {
  background: #3498db;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="navbar">
  <h1>Employee Attendance</h1>
  <button onclick="window.location.href='product.html'">Products</button>
</div>

<div class="container">
  <!-- Add Employee -->
  <div class="card">
    <h2>Add Employee</h2>
    <form id="employeeForm">
      <label>Name: <input type="text" id="name" required></label>
      <label>Position:
        <select id="position" required>
          <option value="Employee">Employee</option>
          <option value="Supervisor">Supervisor</option>
        </select>
      </label>
      <label>Email: <input type="email" id="email" required></label>
      <label>Phone: <input type="text" id="phone" required></label>
      <label>Password: <input type="text" id="password" required></label>
      <label>Salary/Day: <input type="number" id="salary" required></label>
      <button type="submit">Add</button>
    </form>
  </div>

  <!-- Employee Cards -->
  <div id="employeeCards"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } 
from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// ðŸ”¥ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDz-C00gltYO9zkYvcrGnaPVwCHcem-7jY",
  authDomain: "arafa-bakery-33906.firebaseapp.com",
  projectId: "arafa-bakery-33906",
  storageBucket: "arafa-bakery-33906.appspot.com",
  messagingSenderId: "362520951276",
  appId: "1:362520951276:web:ead930237865e9aa69e8c9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const employeeCards = document.getElementById("employeeCards");
const attendanceData = {};
const advanceData = {};

const monthNames = [
  "January","February","March","April","May","June",
  "July","August","September","October","November","December"
];
const now = new Date();
const currentYear = now.getFullYear();
const currentMonth = now.getMonth() + 1;

function getDaysInMonth(year, month) {
  return new Date(year, month, 0).getDate();
}

async function loadEmployees() {
  const snapshot = await getDocs(collection(db, "employees"));
  employeeCards.innerHTML = "";

  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const id = docSnap.id;
    attendanceData[id] = data.attendance || {};
    advanceData[id] = data.advances || {};

    const monthSelect = `<select id="month-${id}" onchange="renderAttendanceGrid('${id}')">
      ${monthNames.map((m, i) =>
        `<option value="${i + 1}" ${i + 1 === currentMonth ? "selected" : ""}>${m}</option>`
      ).join("")}
    </select>`;
    const yearSelect = `<select id="year-${id}" onchange="renderAttendanceGrid('${id}')">
      ${[currentYear - 1, currentYear, currentYear + 1].map(y =>
        `<option value="${y}" ${y === currentYear ? "selected" : ""}>${y}</option>`
      ).join("")}
    </select>`;

    const card = document.createElement("div");
    card.className = "employee-card";
    card.innerHTML = `
      <h3>${data.name}</h3>
      <p><b>Position:</b>
        <select id="position-${id}">
          <option value="Employee" ${data.position === "Employee" ? "selected" : ""}>Employee</option>
          <option value="Supervisor" ${data.position === "Supervisor" ? "selected" : ""}>Supervisor</option>
        </select>
      </p>
      <p><b>Email:</b> <input type="email" id="email-${id}" value="${data.email}"></p>
      <p><b>Phone:</b> <input type="text" id="phone-${id}" value="${data.phone}"></p>
      <p><b>Password:</b> <input type="text" id="password-${id}" value="${data.password}"></p>
      <p><b>Month:</b> ${monthSelect} ${yearSelect}</p>
      <div id="attendance-grid-${id}" class="attendance-grid"></div>
      <p><b>Salary/day:</b> <input type="number" id="salary-${id}" value="${data.salary}"></p>
      <p><b>Total Salary:</b> <span id="monthly-salary-${id}">â‚¹0</span></p>
      <div class="actions">
        <button class="btn btn-edit" onclick="updateEmployee('${id}')">Update</button>
        <button class="btn btn-delete" onclick="deleteEmployee('${id}')">Delete</button>
      </div>`;
    employeeCards.appendChild(card);
    renderAttendanceGrid(id);
  });
}

// ðŸŽ¯ Render Attendance
window.renderAttendanceGrid = function(id) {
  const year = parseInt(document.getElementById(`year-${id}`).value);
  const month = parseInt(document.getElementById(`month-${id}`).value);
  const monthKey = `${year}-${String(month).padStart(2,"0")}`;
  const perDay = parseFloat(document.getElementById(`salary-${id}`).value || 0);
  const days = getDaysInMonth(year, month);
  attendanceData[id][monthKey] = attendanceData[id][monthKey] || {};
  advanceData[id][monthKey] = advanceData[id][monthKey] || {};
  let totalSalary = 0, totalAdvance = 0;
  const grid = [];

  for (let d = 1; d <= days; d++) {
    const dayStr = String(d).padStart(2,"0");
    const status = attendanceData[id][monthKey][dayStr] || "";
    const adv = advanceData[id][monthKey][dayStr] || 0;
    const color = status === "P" ? "present" : status === "A" ? "absent" : status === "H" ? "half" : "empty";
    grid.push(`<button class="attendance-btn ${color}" onclick="toggleAttendance('${id}','${monthKey}','${dayStr}')">${d}</button>`);
    if (status === "P") totalSalary += perDay;
    if (status === "H") totalSalary += perDay / 2;
    totalAdvance += adv;
  }
  document.getElementById(`attendance-grid-${id}`).innerHTML = grid.join("");
  document.getElementById(`monthly-salary-${id}`).textContent = `â‚¹${(totalSalary - totalAdvance).toFixed(2)} (Adv â‚¹${totalAdvance})`;
};

// ðŸŽ¯ Toggle Attendance
window.toggleAttendance = function(id, monthKey, day) {
  const current = attendanceData[id][monthKey][day] || "";
  const next = current === "" ? "P" : current === "P" ? "A" : current === "A" ? "H" : "";
  const adv = prompt(`Advance for day ${day}?`, advanceData[id][monthKey][day] || 0);
  attendanceData[id][monthKey][day] = next;
  advanceData[id][monthKey][day] = parseFloat(adv) || 0;
  renderAttendanceGrid(id);
};

// ðŸŽ¯ Add / Update / Delete
document.getElementById("employeeForm").addEventListener("submit", async e => {
  e.preventDefault();
  const data = {
    name: name.value, position: position.value, email: email.value,
    phone: phone.value, password: password.value, salary: parseFloat(salary.value),
    attendance: {}, advances: {}
  };
  await addDoc(collection(db, "employees"), data);
  e.target.reset();
  loadEmployees();
});

window.updateEmployee = async id => {
  const ref = doc(db, "employees", id);
  await updateDoc(ref, {
    email: document.getElementById(`email-${id}`).value,
    phone: document.getElementById(`phone-${id}`).value,
    password: document.getElementById(`password-${id}`).value,
    position: document.getElementById(`position-${id}`).value,
    salary: parseFloat(document.getElementById(`salary-${id}`).value),
    attendance: attendanceData[id], advances: advanceData[id]
  });
  alert("Updated!");
};

window.deleteEmployee = async id => {
  if (confirm("Delete employee?")) {
    await deleteDoc(doc(db, "employees", id));
    loadEmployees();
  }
};

loadEmployees();
</script>
</body>
</html>
